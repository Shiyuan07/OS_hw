## 第七讲视频相关思考题

### 7.1 了解x86保护模式中的特权级

1. X86有几个特权级？
CPU支持4个特权级，通常操作系统只使用了2个。
2. 不同特权级有什么区别？
特权指令只能在ring 0使用；一条指令在不同特权下能访问的数据范围是不一样的；一条指令在不同特权级下的行为是不一样的

3. 请说明CPL、DPL和RPL在中断响应、函数调用和指令执行时的作用。
CPL：当前进程的优先级；DPL：数据被访问需要的优先级；RPL：进程请求的优先级；
访问门时是低优先级代码访问高优先级服务，需要CPL<=DPL[门]&CPL>=DPL[段]；
访问段是为高优先级代码访问低优先级数据，需要MAX(CPL,RPL) <= DPL[段]。

4. 写一个示例程序，完成4个特权级间的函数调用和数据访问时特权级控制的作用。

### 7.2 了解特权级切换过程

1. 一条指令在执行时会有哪些可能的特权级判断？
当前指令需要什么样的特权级
中断等特殊指令在什么特权及下执行
当前的特权级能否执行该指令
执行特权指令是否在内核态；
访问的数据是否符合特权级的要求；
2. 在什么情况下会出现特权级切换？
中断、函数调用、系统调用
3. int指令在ring0和ring3的执行行为有什么不同？
在ring3会进行堆栈切换并将SS和ESP压栈

4. 如何利用int和iret指令完成不同特权级的切换？
在指令执行前修改堆栈，让其与需要切换的特权级进入中断时的栈相同。

5. TSS和Task Register的作用是什么？
TSS保存ring 0到ring 2三个特权级里面的堆栈信息
Task Register缓存TSS里面的内容

### 7.3 了解段/页表

1. 一条指令执行时最多会出现多少次地址转换？
页表级数+1
2. 描述X86-32的MMU地址转换过程；
从段描述符中得到段基址，从offset得到线性地址，得到页目录的地址和偏移。再通过多级页表确定偏移，最终确定物理地址。
### 7.4 了解UCORE建立段/页表

1. 分析MMU的使能过程，尽可能详细地分析在执行进入保护械的代码“movl %eax, %cr0 ; ljmp $CODE_SEL, $0x0”时，CPU的状态和寄存器内容的变化。
设置各段基址。打开cr0的保护模式位，进入保护模式，开启MMU。
2. 分析页表的建立过程；
将一页设置为页目录
将页目录clear
将0xC0000000-0xF8000000(va)映射到0x00000000-0x38000000
将0x00000000-0x00100000(va)映射到0x00000000-0x00100000(pa)
设置cr3和cr0的第31位
更新GDT
取消0x00000000-0x00100000的映射